{
  "entities": {
    "CreditCardTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CreditCardTransaction",
      "type": "object",
      "description": "Represents a single transaction from a credit card statement.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Credit Card Transaction entity."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date when the transaction occurred.",
          "format": "date-time"
        },
        "postingDate": {
          "type": "string",
          "description": "The date when the transaction was posted to the account.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction. Positive values indicate charges, negative values indicate credits."
        }
      },
      "required": [
        "id",
        "transactionDate",
        "postingDate",
        "description",
        "amount"
      ]
    },
    "DepositAccountTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DepositAccountTransaction",
      "type": "object",
      "description": "Represents a single transaction from a deposit account statement.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Deposit Account Transaction entity."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date when the transaction occurred.",
          "format": "date-time"
        },
        "transactionTime": {
          "type": "string",
          "description": "The time when the transaction occurred."
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction, combining summary and ledger note."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction. Positive values indicate withdrawals, negative values indicate deposits."
        },
        "otherPartyBankCode": {
          "type": "string",
          "description": "Bank code of the other party involved in the transaction."
        },
        "otherPartyAccountNumber": {
          "type": "string",
          "description": "Account number of the other party involved in the transaction."
        }
      },
      "required": [
        "id",
        "transactionDate",
        "transactionTime",
        "description",
        "amount"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/creditCardTransactions/{transactionId}",
        "definition": {
          "entityName": "CreditCardTransaction",
          "schema": {
            "$ref": "#/backend/entities/CreditCardTransaction"
          },
          "description": "Stores credit card transaction data for a specific user. Access is restricted to the owner of the user document based on their UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns the transaction."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the credit card transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/depositAccountTransactions/{transactionId}",
        "definition": {
          "entityName": "DepositAccountTransaction",
          "schema": {
            "$ref": "#/backend/entities/DepositAccountTransaction"
          },
          "description": "Stores deposit account transaction data for a specific user. Access is restricted to the owner of the user document based on their UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns the transaction."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the deposit account transaction."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to securely store and manage financial transaction data extracted from user-provided bank statements. The structure emphasizes authorization independence, clarity, and scalability, adhering to the principles outlined in the prompt.\n\n**Authorization Independence and QAPs:**\n\n*   The primary means of ensuring authorization independence is through path-based ownership. Transactions (both CreditCardTransaction and DepositAccountTransaction) are stored as subcollections of user documents (`/users/{userId}/creditCardTransactions/{transactionId}` and `/users/{userId}/depositAccountTransactions/{transactionId}`). This eliminates the need for `get()` calls in security rules, enabling atomic operations.\n\n*   QAPs are supported through structural segregation. Each user's transactions are isolated within their user document, ensuring that listing transactions only returns data accessible to that specific user. Access is always based on `request.auth.uid`.\n\n**Data Clarity and Predictability:**\n\n*   The schema for each transaction type (`CreditCardTransaction`, `DepositAccountTransaction`) is explicitly defined, ensuring data consistency and predictability.\n*   Field names are semantically clear (e.g., `transactionDate`, `amount`).\n\n**Denormalization Strategy:**\n\n*   In this specific structure, explicit denormalization of user data into each transaction document is not required since path-based ownership implicitly grants access via `request.auth.uid == userId`.\n\nThis structure facilitates robust and easily debuggable security rules, as access control is directly tied to the user's ID and the path of the data."
  }
}