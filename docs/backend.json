{
  "entities": {
    "CreditCardTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CreditCardTransaction",
      "type": "object",
      "description": "Represents a single credit card transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the credit card transaction."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date the transaction occurred.",
          "format": "date"
        },
        "postingDate": {
          "type": "string",
          "description": "The date the transaction was posted to the account.",
          "format": "date"
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction."
        }
      },
      "required": [
        "id",
        "transactionDate",
        "postingDate",
        "description",
        "amount"
      ]
    },
    "DepositAccountTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DepositAccountTransaction",
      "type": "object",
      "description": "Represents a single transaction in a deposit account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the deposit account transaction."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date the transaction occurred.",
          "format": "date"
        },
        "time": {
          "type": "string",
          "description": "The time the transaction occurred."
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction, including combined summary and passbook remarks."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction (positive for withdrawals, negative for deposits)."
        },
        "counterpartyBankCode": {
          "type": "string",
          "description": "The bank code of the counterparty."
        },
        "counterpartyAccountNumber": {
          "type": "string",
          "description": "The account number of the counterparty."
        }
      },
      "required": [
        "id",
        "transactionDate",
        "time",
        "description",
        "amount"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/creditCardTransactions/{transactionId}",
        "definition": {
          "entityName": "CreditCardTransaction",
          "schema": {
            "$ref": "#/backend/entities/CreditCardTransaction"
          },
          "description": "Stores credit card transaction data for a specific user. The userId parameter identifies the owner of the transactions.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns the transaction."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the credit card transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/depositAccountTransactions/{transactionId}",
        "definition": {
          "entityName": "DepositAccountTransaction",
          "schema": {
            "$ref": "#/backend/entities/DepositAccountTransaction"
          },
          "description": "Stores deposit account transaction data for a specific user. The userId parameter identifies the owner of the transactions.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns the transaction."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the deposit account transaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to securely store and manage financial transaction data parsed from user-provided bank statements. It prioritizes authorization independence, clarity, and scalability.  Given that users parse data from their own bank statements, the primary authorization model is path-based ownership under each user's document.  This approach avoids complex authorization logic and enables atomic operations.  The structure leverages structural segregation, separating credit card transactions and deposit account transactions into distinct subcollections under each user's document to simplify security rules and improve query performance. Each document contains only the data it needs, eliminating unnecessary data transfer and reducing storage costs. Finally, the structure models data clarity through standard naming and explicit data types to improve maintainability.\n\n**Authorization Independence:** Authorization is achieved through path-based ownership under `/users/{userId}`.  No `get()` calls are needed in security rules because access control is based on the user's ID in the path. The `userId` parameter identifies the owner of the transactions.\n\n**QAPs (Rules are not Filters):** The path-based ownership structure enables secure `list` operations.  A user can only list transactions under their own `userId`, which is validated in the security rules.\n\n**Denormalization:** While not explicitly denormalizing user roles in this scenario (since access is based solely on ownership), one could extend the model to include shared accounts, in which case the `members` map and role definitions should be denormalized onto the documents."
  }
}