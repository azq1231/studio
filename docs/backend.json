{
  "entities": {
    "CreditCardTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CreditCardTransaction",
      "type": "object",
      "description": "Represents a single credit card transaction record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the credit card transaction."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date when the transaction occurred, in YYYY-MM-DD format.",
          "format": "date"
        },
        "postingDate": {
          "type": "string",
          "description": "The date when the transaction was posted to the account, in YYYY-MM-DD format.",
          "format": "date"
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction, including the merchant or service."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction. Positive for charges, negative for credits."
        }
      },
      "required": [
        "id",
        "transactionDate",
        "description",
        "amount"
      ]
    },
    "DepositAccountTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DepositAccountTransaction",
      "type": "object",
      "description": "Represents a single transaction record for a deposit account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the deposit account transaction."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date when the transaction occurred, in YYYY-MM-DD format.",
          "format": "date"
        },
        "transactionTime": {
          "type": "string",
          "description": "The time when the transaction occurred, in HH:MM:SS format."
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction. Positive for withdrawals, negative for deposits."
        },
        "otherPartyBankCode": {
          "type": "string",
          "description": "The bank code of the other party involved in the transaction, if applicable."
        },
        "otherPartyAccountNumber": {
          "type": "string",
          "description": "The account number of the other party involved in the transaction, if applicable."
        }
      },
      "required": [
        "id",
        "transactionDate",
        "transactionTime",
        "description",
        "amount"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/creditCardTransactions/{transactionId}",
        "definition": {
          "entityName": "CreditCardTransaction",
          "schema": {
            "$ref": "#/backend/entities/CreditCardTransaction"
          },
          "description": "Stores credit card transactions for a specific user. Only the user with the matching userId can access these transactions.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the credit card transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/depositAccountTransactions/{transactionId}",
        "definition": {
          "entityName": "DepositAccountTransaction",
          "schema": {
            "$ref": "#/backend/entities/DepositAccountTransaction"
          },
          "description": "Stores deposit account transactions for a specific user. Only the user with the matching userId can access these transactions.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the deposit account transaction."
            }
          ]
        }
      }
    ],
    "reasoning": "This design prioritizes security and scalability for the FinanceFlow application. Given that users will be pasting bank statements and the application will parse and present this data, the structure focuses on isolating user data. Each user has exclusive access to their parsed transactions, ensuring privacy and preventing unauthorized access.\n\nAuthorization Independence: The design uses path-based ownership under `/users/{userId}`. This structure inherently provides authorization independence because access control is determined directly by the path and the authenticated user's ID (`request.auth.uid`). No `get()` calls are required in the security rules to check parent document properties.\n\nQAPs (Rules are not Filters):\n*   Secure List Operations: Because data is segregated by user ID, listing transactions is inherently secure. Rules can easily allow listing all documents under `/users/{userId}/creditCardTransactions` or `/users/{userId}/depositAccountTransactions` where `request.auth.uid == userId`. There's no need to filter based on document content, avoiding the 'rules are not filters' problem.\n*   Ownership: Path-based ownership (`/users/{userId}`) makes ownership clear and enforceable in security rules.\n\nThe design segregates credit card and deposit account transactions into separate subcollections under each user to maintain a homogeneous security posture within each collection, simplifying rules. The structure is:\n\n/users/{userId}/creditCardTransactions/{transactionId}\n/users/{userId}/depositAccountTransactions/{transactionId}\n\nThis ensures that all documents in a collection share the same security requirements (owned by the user), avoiding the need for complex rule logic based on document content."
  }
}